



### **Part 1: Host Discovery**

#### **A. Professional Summary **

**Objective:** Host Discovery is the critical first phase of active reconnaissance, focused on identifying live hosts within a target network range. This process is essential for mapping the attack surface and optimizing subsequent, more intensive scanning phases.

**Strategic Approach:** Effective host discovery is not reliant on a single technique but on a versatile methodology adapted to the target environment. The core strategy involves bypassing network filtering (firewalls, IDS) by employing a variety of probes.

* **For Local Area Networks (LAN):** The **ARP Scan (`-PR`)** is the most reliable and efficient method, operating at Layer 2 to accurately identify all active devices.
* **For Wide Area Networks (WAN):** A multi-pronged approach is necessary. While a standard **ICMP Echo Ping (`-PE`)** is often blocked, techniques like **TCP SYN/ACK Pings (`-PS`/`-PA`)** are highly effective as they mimic legitimate network traffic (e.g., web requests) that firewalls are configured to allow. For more heavily filtered environments, obscure probes such as **ICMP Timestamp/Address Mask Pings (`-PP`/`-PM`)** and **IP Protocol Scans (`-PO`)** can uncover hosts by leveraging less common, often unmonitored protocols.

This multi-faceted approach ensures a comprehensive and stealthy enumeration of live targets, forming a solid foundation for the subsequent port scanning and vulnerability analysis stages.

---














## B. Personal Deep Dive Notes 

در این بخش، تمام نکات کلیدی، مثال‌ها و منطق فنی هر تکنیک را برای یادگیری عمیق و مرور آینده ثبت می‌کنم. این یک مرجع کامل برای درک استراتژی پشت هر دستور است.

---

### **۱. ARP Ping Scan (`-PR`)**

> **برداشت من:** این روش در شبکه محلی (LAN) بسیار خوب و مطمئن است، چون اکثر فایروال‌ها درخواست ARP را بلاک نمی‌کنند.

🧠 **یادآوری با مثال (Analogy):**
این تکنیک مثل این است که وارد یک اتاق شوی و با صدای بلند بپرسی **"هرکس که اینجا هست، لطفاً اسم و مشخصاتش رو بگه!"**. چون همه در یک فضای مشترک (شبکه محلی) هستند و برای ارتباط با یکدیگر به این مکانیزم نیاز دارند، تقریباً همه مجبور به پاسخ دادن هستند.

⚙️ **منطق فنی و استراتژی:**
این اسکن در **لایه ۲ شبکه (Data Link)** کار می‌کند، یعنی حتی قبل از اینکه IP (لایه ۳) وارد ماجرا شود. پروتکل ARP (Address Resolution Protocol) برای ترجمه آدرس‌های IP به آدرس‌های فیزیکی MAC ضروری است. هیچ دستگاهی نمی‌تواند در یک شبکه محلی بدون پاسخ به درخواست‌های ARP به درستی کار کند. به همین دلیل، مسدود کردن آن توسط فایروال‌های روی سیستم‌ها بسیار نادر است، چون این کار عملاً ارتباط دستگاه با شبکه را قطع می‌کند. به همین خاطر این روش **سریع‌ترین و قابل اعتمادترین** راه برای شناسایی تمام دستگاه‌های فعال در یک شبکه محلی است.

챌 **نکته کلیدی/چالش:**
در تست اولیه، این اسکن نتوانست گوشی موبایل متصل به شبکه را پیدا کند. دلیل اصلی، **حالت‌های ذخیره انرژی (Power-Saving Mode)** در گوشی‌هاست. وقتی صفحه گوشی خاموش است، کارت شبکه وای‌فای برای صرفه‌جویی در باتری به حالت "چرت" می‌رود و به درخواست‌های عمومی (Broadcast) مثل ARP پاسخ نمی‌دهد. این یک درس مهم است: نتایج اسکن همیشه تصویری از یک لحظه خاص هستند و ممکن است به دلیل شرایط هدف، کامل نباشند.

⚡️ **دستور اصلی (Command):**
`sudo nmap -sn -PR 192.168.1.0/24`

---

### **۲. TCP SYN Ping (`-PS`)**

> **برداشت من:** یکی از مهم‌ترین و قدرتمندترین ابزارها برای کشف سیستم در اینترنت. این متد یک پکت SYN می‌فرستد و شروع یک دست دادن سه مرحله‌ای را رقم می‌زند. هاست یا می‌خواهد ارتباط شکل بگیرد و جواب می‌دهد یا می‌خواهد شکل نگیرد و باز هم جواب می‌دهد.

🧠 **یادآوری با مثال:**
تکنیک **"زنگ بزن و فرار کن" (Ding-Dong Ditch)**. ما اولین مرحله از یک ارتباط کاملاً عادی و قانونی (فشردن زنگ / ارسال `SYN`) را انجام می‌دههیم. به محض گرفتن هر نوع واکنشی از داخل خانه (باز شدن در / دریافت `SYN/ACK` یا دادی از پشت در / دریافت `RST`)، ما به هدفمان رسیده‌ایم و بلافاصله فرار می‌کنیم (ارسال `RST` برای قطع ارتباط).

⚙️ **منطق فنی و استراتژی:**
این روش یک بسته TCP با فلگ `SYN` به یک پورت مشخص (پیش‌فرض پورت ۸۰) ارسال می‌کند.
* **اگر پورت باز باشد:** سیستم هدف با یک بسته `SYN/ACK` پاسخ می‌دهد.
* **اگر پورت بسته باشد:** سیستم هدف با یک بسته `RST` پاسخ می‌دهد.
در هر دو حالت، ما یک **پاسخ مستقیم** از هدف دریافت کرده‌ایم که فعال بودن آن را با قطعیت ۱۰۰٪ تایید می‌کند. استراتژی کلیدی در اینجا، استفاده از پورت‌های رایجی مثل **۸۰ (HTTP)** و **۴۴۳ (HTTPS)** است. چرا؟ چون تقریباً هیچ فایروالی در دنیا ترافیک خروجی به سمت این پورت‌ها را مسدود نمی‌کند، وگرنه کارمندان آن شرکت نمی‌توانند وب‌گردی کنند! این باعث می‌شود `-PS` یکی از قابل اعتمادترین روش‌ها برای اهداف اینترنتی باشد.

⚡️ **دستور اصلی (Command):**
`sudo nmap -sn -PS80,443,8080 <target>`

---

### **۳. TCP ACK Ping (`-PA`)**

> **برداشت من:** این روش مکملی برای SYN Ping است و به صورت سرزده فلگ تاییدیه می‌فرستد. در تست من، `-PS` جواب داد اما این متود نه، که نشان می‌دهد به تنظیمات فایروال هدف بستگی دارد.

🧠 **یادآوری با مثال:**
تکنیک **"تحویل بسته اشتباهی"**. ما وانمود می‌کنیم که در اواسط یک مکالمه هستیم و یک بسته `ACK` (تاییدیه) برای هدف می‌فرستیم. این مانند این است که یک پستچی بسته‌ای را دم در بیاورد و بگوید "لطفاً رسید تحویل را امضا کنید". صاحب‌خانه که می‌داند چیزی سفارش نداده، با عصبانیت پاسخ می‌دهد "من چیزی سفارش ندادم!" (ارسال `RST`). همین پاسخ عصبانی، وجود او را برای ما تایید می‌کند.

⚙️ **منطق فنی و استراتژی:**
این تکنیک برای فریب دادن **فایروال‌های با وضعیت (Stateful Firewalls)** طراحی شده است. این فایروال‌ها تمام مکالمات را ردیابی می‌کنند و انتظار دارند هر ارتباطی با `SYN` شروع شود. وقتی یک بسته `ACK` تنها و بی‌ربط از راه می‌رسد، برخی فایروال‌های ساده‌تر گیج شده و آن را عبور می‌دهند تا ببینند خود سیستم‌عامل چه واکنشی نشان می‌دهد. سیستم‌عامل طبق قانون موظف است با `RST` پاسخ دهد. شکست این تست در آزمایش شما نشان می‌دهد که فایروال هدف به اندازه کافی هوشمند بوده که هر بسته‌ای که به یک ارتباط فعال تعلق ندارد را مسدود کند.

⚡️ **دستور اصلی (Command):**
`sudo nmap -sn -PA80,443 <target>`

---

### **۴. UDP Ping (`-PU`)**

> **برداشت من:** این روش عمدتاً برای اینترنت است. یک پکت UDP خالی به یک پورت غیرمعقول می‌فرستد و اگر پورت بسته باشد، سیستم پیام "Port Unreachable" برمی‌گرداند. اگر جواب سکوت باشد، ممکن است فایروال بسته را مسدود کرده باشد.

🧠 **یادآوری با مثال:**
تکنیک **"نامه بی‌نام و نشان"**. یک پاکت خالی به یک آدرس پرت و یک واحد غیرموجود در یک ساختمان می‌فرستیم.
* **حالت ۱:** مدیر ساختمان (سیستم‌عامل) نامه را می‌بیند و یک اخطار "چنین واحدی وجود ندارد" (ICMP Port Unreachable) برای اداره پست می‌فرستد. **این پاسخ قطعی، زنده بودن ساختمان را تایید می‌کند.**
* **حالت ۲:** نگهبان ساختمان (فایروال) نامه را می‌بیند و آن را دور می‌اندازد. ما هیچ خبری دریافت نمی‌کنیم. **این سکوت می‌تواند به معنی فعال بودن ساختمان و یا نبودن آن باشد.**

⚙️ **منطق فنی و استراتژی:**
اسکن UDP به دلیل ماهیت غیرقابل اعتماد و بدون اتصال UDP، ذاتا کند و مبهم است. Nmap باید خودش زمان‌بندی و تلاش‌های مجدد را مدیریت کند. نتیجه `open|filtered` دقیقاً به همین ابهام اشاره دارد: "من یک بسته فرستادم و هیچ جوابی نگرفتم. نمی‌دانم پورت باز بود و جواب نداد، یا یک فایروال در مسیر آن را حذف کرد." با این حال، این روش برای دور زدن فایروال‌هایی که فقط ترافیک TCP و ICMP را زیر نظر دارند، مفید است.

⚡️ **دستور اصلی (Command):**
`sudo nmap -sn -PU <target>`

---

### **۵. انواع پینگ ICMP (`-PE`, `-PP`, `-PM`)**

> **برداشت من:** `-PE` همان پینگ معمولی است که اغلب در اینترنت مسدود می‌شود. `-PP` و `-PM` از قابلیت‌های قدیمی ICMP (پرسیدن ساعت و ساب‌نت مسک) استفاده می‌کنند که مدیران شبکه اغلب فراموش می‌کنند آن‌ها را مسدود کنند و این یک نقطه کور برای نفوذ است.

🧠 **یادآوری با مثال:**
این سه تکنیک مانند سه سوال متفاوت از نگهبان دم در هستند:
* **-PE (Echo):** سوال مستقیم: **"علی اونجایی؟"** (اغلب مسدود می‌شود).
* **-PP (Timestamp):** سوال هوشمندانه: **"ببخشید، ساعت چنده؟"** (اغلب مسدود نمی‌شود).
* **-PM (Address Mask):** سوال عجیب و قدیمی: **"نقشه این محله رو داری؟"** (تقریباً هرگز مسدود نمی‌شود).

⚙️ **منطق فنی و استراتژی:**
قدرت این تکنیک‌ها در استفاده از **انواع پیام (Message Types)** مختلف ICMP است.
* `-PE` از پیام نوع **۸ (Echo Request)** استفاده می‌کند که بسیار معروف است.
* `-PP` از پیام نوع **۱۳ (Timestamp Request)** استفاده می‌کند که کمتر شناخته شده است.
* `-PM` از پیام نوع **۱۷ (Address Mask Request)** استفاده می‌کند که تقریباً منسوخ شده است.
استراتژی در اینجا، بهره‌برداری از تنظیمات ناقص فایروال است. مدیر شبکه فقط معروف‌ترین نوع ICMP را مسدود کرده و بقیه را به حال خود رها کرده است.

⚡️ **دستورات (Commands):**
`sudo nmap -sn -PE <target>`
`sudo nmap -sn -PP <target>`
`sudo nmap -sn -PM <target>`

---

### **۶. IP Protocol Ping (`-PO`)**

> **برداشت من:** این متد جالب، هدر IP را به پروتکل‌های ناشناخته تغییر می‌دهد (نه TCP، نه UDP و نه ICMP). فایروال ممکن است نحوه برخورد با این پروتکل‌های خاص را بلد نباشد و اجازه عبور بدهد.

🧠 **یادآوری با مثال:**
تکنیک **"ارسال تلگرام به جای نامه"**. ما فرمت ارتباطی را کاملاً عوض می‌کنیم. نگهبان (فایروال) فقط برای بازرسی نامه‌های استاندارد (TCP/UDP/ICMP) آموزش دیده است. وقتی یک تلگرام با فرمتی کاملاً متفاوت به دستش می‌رسد، نمی‌داند با آن چه کار کند و از روی شک، اجازه عبور می‌دهد.

⚙️ **منطق فنی و استراتژی:**
این روش در **لایه ۳ (IP)** عمل می‌کند. در هدر هر بسته IP، یک فیلد ۸ بیتی به نام "Protocol" وجود دارد که مشخص می‌کند محتوای بسته چیست (مثلاً 6=TCP, 17=UDP, 1=ICMP). Nmap بسته‌هایی با شماره پروتکل‌های دیگر (مثل 2=IGMP یا 4=IP-in-IP) ارسال می‌کند. اگر سیستم هدف با پیام ICMP "Protocol Unreachable" پاسخ دهد، زنده بودن آن تایید می‌شود. این یک تکنیک بسیار پیشرفته برای پیدا کردن نقاط کور در سیاست‌های امنیتی فایروال است که فقط روی پروتکل‌های معروف تمرکز کرده‌اند.



⚡️ **دستور اصلی (Command):**
`sudo nmap -sn -PO <target>`


---

### **Part 2: Port & Service Scanning**




**nmap -sT (TCP Connect Scan): این روش برای شناسایی پورت ها استفاده میشه و هدفش اینه که به شکل عادی برا هر پورت از تارگت , یه پکت تی سی پی ارسال و منتظر جواب بمونه و دست دادن 3 مرحله ای رو انجام بده . قابل اعتماد هست اما سر و صدای زیادی داره چون همه چیز توی لاگ ها به جا میمونه ! نیاز به دسترسی بالا ام نداره چون استاندارد کارش رو انجام میده ! 

**nmap -sS (Stealth Port Scan): همون متود قبلیه ولی به جای اینکه دست داد سه گانه رو کامل انجام بده , بعد از گرفتن پاسخ چه تایید باشه و چه ریست , ارتباط رو با فلگ ریست ریست میکنه ! امن تره چون لاگ کمتری به جا میزاره برای فایروال های قدیمی و سریع تره چون کامل ارتباط رو انجام نمیده

**nmap -sX (Xmas Scan): پر سر و صدا ترین اسکن ! برای اینکه این اسکن یه پکت تی سی پی با فلگ های بی ربط میفرسته و اگه دستگاه قدیمی باشه متوجه اون نمیشه ولی اگه پورت بسته باشه یه جواب به ما میرسه و متوجه میشیم که پورت بستست ! توی باز بودن پورت نمیتونیم تصمیم بگیریم چون شاید فایروال جلوی پکت رو گرفته باشه اما درباره بسته بودنش میتونیم تصمیم بگیریم ! و اینکه پیشنهاد نمیشه برای سیستم های امروزی 

**nmap -sM (Tcp Maimon Port Scan): یه روش منسوخ شده که روی سیستم های قدیمی کار میکنه ! میاد و یه پکت با فلگ فینیش و تایید میفرسته و سیستم های جدید به محض دیدن فینیش چه پورت باز باشه و چه بسته ارتباط رو ریست میکنن اما قدیمی ها اگر پورت بسته باشه ریست و اگر پورت باز باشه سکوت میکنن ! و نمیفهمیم پورت باز بود یا فیلتر شد ! خیلی قابل اعتماد و کارامد نیست 

**nmap -sA (Tcp Scan ) : این نوع اسکن برای مشخص کردن باز یا بسته بودن پورت نیست و میخواد نشون بده پورت فیلتر هست یا فیلتر نیست و قدرت فایروال رو نشون میده ! اگر پورت باز یا بسته باشه ریست میکنه و میفهمیم پکت از فایروال رد شده اما اگه توی سکوت رها شد یعنی پکت فیلتر شده 












